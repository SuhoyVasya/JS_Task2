Я накосячил и отправил предыдущую версию кода, которая к тому-же нерабочая. Замечания исправил
1) onEntry, onExit могут быть описаны в объекте actions.
2) Можно делать несколько автоматов втч и вложенные как в примере кода.